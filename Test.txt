from O365 import Account
import joblib
from sklearn.feature_extraction.text import CountVectorizer

# Charger ton modèle de détection de spams
model = joblib.load('model1.pkl')
vectorizer = CountVectorizer()

# Authentification avec Microsoft 365 (Outlook)
credentials = ('client_id', 'client_secret')
account = Account(credentials)

# Authentification interactive (OAuth)
if not account.is_authenticated:
    # Authentification initiale
    account.authenticate(scopes=['basic', 'message_all'])

# Récupérer les e-mails
mailbox = account.mailbox()
inbox = mailbox.inbox_folder()
messages = inbox.get_messages(limit=10)

# Fonction de détection de spam
def detect_spam(email_body):
    email_vector = vectorizer.transform([email_body])
    prediction = model.predict(email_vector)
    return prediction[0]  # 1 pour spam, 0 pour non-spam

# Analyser les e-mails
for message in messages:
    subject = message.subject
    body = message.body
    is_spam = detect_spam(body)

    if is_spam:
        print(f"Spam detected: {subject}")
    else:
        print(f"Not a spam: {subject}")
